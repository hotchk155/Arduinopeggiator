This is the Arduino sketch that runs on my Arduino-based MIDI arpeggiator
See the project wiki from more info

I have created an updated version for etched boards... please see https://github.com/hotchk155/ArduinopeggiatorV2